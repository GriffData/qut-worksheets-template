
***
*Solution:*

(a)

```{r id0011-solution-a, fig.margin = TRUE, fig.cap = "Q-Q plot and KDE for varying $\\lambda$.", fig.width=3.5, fig.height=3, cache=FALSE}

  library(ggplot2);library(dplyr);library(purrr)

  x <- c(0.07, 3.35, 35.58, 21.14, 0.15, 0.73, 
         8.47, 0.9, 0.43, 39.69, 3.19, 0.19, 4.24, 
         0.13, 6.09, 0.8, 171.8, 1.25, 48.03, 8.6)
  
  boxcox <- function(x, lambda = 0L){
    
    if(lambda == 0L){
      log(x)
    } else {
      (x^lambda - 1) / lambda
    }
    
  }
  
  inv_boxcox <- function(z, lambda = 0L){
    
    if(lambda == 0L){
      exp(z)
    } else {
      (lambda * z + 1)^(1/lambda)
    }
    
  }
  
  lambda_vals <- tibble(
    lambda  = c(0, 0.1, 0.2, 0.5, 1, 2),
    id  = as.character(1:6)
  )
  
  df <- lambda_vals$lambda %>% 
    map_df( ~ tibble(x = boxcox(x, .)), .id = "id") %>%
    left_join(lambda_vals, by = "id")
  
  # Q-Q plot (normal distribution is default comparison)
  ggplot(df, aes(sample=x)) + 
    geom_qq() + geom_qq_line() +
    facet_wrap(~lambda, scales = "free", nrow = 3) +
    theme_bw()
  
  # KDE 
  ggplot(df, aes(x=x)) + 
    geom_density() +
    facet_wrap(~lambda, scales = "free", nrow = 3) +
    theme_bw()

```

It appears that $\lambda = 0$ (or $\log(x)$) creates transformed data which is the closest to being normally distributed based on the Q-Q plot and KDE. 

(b)

```{r id0011-solution-b1, fig.margin = TRUE, fig.cap = "KDEs comparing simulated data to real on original scale.", fig.width=3.5, fig.height=3, cache=FALSE}

  # transformed data:
  z <- boxcox(x = x, lambda = 0L)

  mean_z <- mean(z)
  var_z <- var(z)
  
  z_sim <- rnorm(n = length(z), mean = mean_z, sd = sqrt(var_z))
  
  x_sim <- inv_boxcox(z = z_sim, lambda = 0L)
  
  ggplot() +
    geom_density(aes(x = x), colour = "red") + 
    geom_density(aes(x = x_sim), colour = "black") + 
    theme_bw()

```
It's very difficult to see on this scale. Let's compare on the transformed scale:

```{r id0011-solution-b2, fig.margin = TRUE, fig.cap = "KDEs comparing simulated data to real on transformed scale.", fig.width=3.5, fig.height=3, cache=FALSE}

  ggplot() +
    geom_density(aes(x = z), colour = "red") + 
    geom_density(aes(x = z_sim), colour = "black") + 
    theme_bw()

```
The random samples (`z_sim`) from the normal distribution have a density which is somewhat bell-shaped. However, it does look relatively different to the data we transformed. This is a problem to be aware of in small sized data since empirical estimates (such as KDEs) may have imperfections. We can account for this by comparing the data to several simulated samples of the same size, to get an idea of the appropriateness of the transform. It is better to perform principled statistical methods that perform this procedure, see `forecast::BoxCox.lambda` for example, and then use graphical methods to check the performance.


***